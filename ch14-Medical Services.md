# 🏥 의료 산업의 다차원 모델링 학습 노트

## 1. 🧭 의료 산업의 변화와 데이터 통합의 필요성

- **의료산업의 목표**:
    
    환자의 건강 상태 개선과 **운영 효율성 향상**을 동시에 추구.
    
- **정보 통합 필요성**:
    - 진단 정보
    - 재무 정보
    - 운영성과 지표
    - → 이질적인 시스템 간 통합 필요
- **이유**:
    - 환자 치료의 효과 분석
    - 비용 및 리스크 관리
    - 자원 효율 극대화 (의사, 장비, 시설 등)

---

## 2. 🧱 의료 데이터 웨어하우스 설계 주요 포인트

### 2.1. 버스 매트릭스 예시

- 의료 버스 매트릭스에는 환자, 의사, 보험사, 진료, 처방, 진단, 시설 등의 **공통 디멘션** 정의 필요

### 2.2. 📊 팩트 테이블 설계 유형

| 유형 | 설명 |
| --- | --- |
| 점진적 스냅샷 (Incremental Snapshot) | 청구~지불의 프로세스를 추적 |
| 트랜잭션 팩트 | 진료, 검사, 처방 등 실제 의료행위 발생 기록 |
| 주기적 스냅샷 | 시설/장비 사용률, 종업원 배치 등 운영 상태 캡처 |

---

## 3. 📌 다차원 모델링 기술

### 3.1. ✅ 표준 디멘션들

- 핵심: **환자 디멘션**
    - 마스터 환자 ID 관리가 중요
    - **EMR/EHR 시스템**을 통한 360도 환자 분석 필요
    - 미국은 고유 환자 식별번호 없음 → 식별 이슈 존재
    - 개인정보 보호법(HIPAA) 고려 필수
- 기타 표준 디멘션 예시:
    - 날짜 (Date)
    - 책임 당사자 (e.g. 의사, 직원)
    - 종업원
    - 의료 서비스 계획
    - 보험사 (주 / 보조)
    - 진료, 진단, 검사, 처방
    - 시설 (병원, 요양기관 등)

### 3.2. 롤플레잉 디멘션

- 동일한 디멘션이 여러 역할을 할 때 사용
    - 예: 의사 (담당 의사, 진료 의사, 추천 의사)

### 3.3. 다중 값 디멘션

- 하나의 트랜잭션에 여러 속성이 연결될 때
    - 예: **환자의 다수 진단명**
    - 해결 방법: 브리지 테이블 사용

### 3.4. 슈퍼타입 / 서브타입 디멘션

- 다양한 비용 유형 관리 (예: 약제비, 검사비 등)
    - **공통 속성(Supertype)** + 세부 유형별 속성(Subtype)

### 3.5. 문자 코멘트 처리

- 의사 소견, 진료 기록 등의 텍스트 필드 존재
    - 팩트 테이블 내 별도 컬럼 또는 외부 시스템 연동

### 3.6. 메저먼트 타입 디멘션

- 발생 빈도가 낮거나 다양한 측정값을 구조화
    - 예: 희귀 검사의 수치들

### 3.7. 이미지 데이터 처리

- 예: 엑스레이, MRI
    - 다차원 모델 내에서 **이미지 메타데이터만 저장**하고, 실제 파일은 별도 시스템에서 관리

---

## 4. 🧠 의료 산업의 특별한 고려 사항

### 4.1. 보험사와의 협업

- 보험사는 전통적으로 **정교한 분석 수행 주체**
- 청구 데이터를 통해 리스크 분석 및 사기 탐지 수행
- 현재는 의료기관과 협업해 더 상세한 환자 데이터 확보 시도

### 4.2. 법적/보안 이슈

- 미국 HIPAA: **개인정보 보호 및 보안 요구사항** 엄격
- 환자 식별, 진료 기록 연계 시 반드시 보안 고려

---

## 5. 🩺 코드 체계 및 표준화

- **진단명** → ICD (국제 질병 분류)
- **진료 코드** → HCPCS, CPT 기반
    - CPT: 의료/수술/진단/물품에 대한 미국 의학협회 분류체계

---

## 6. 📈 운영 성과 데이터 통합

- 의료 기관은 재무 외에도 **운영 데이터 분석**에 관심
    - 직원 배치, 장비 활용률, 약품 재고 등
    - 앞선 인적 자원, 재고관리, 조달관리와 연결 가능

---

## 💡 정리 및 인사이트

| 항목 | 내용 |
| --- | --- |
| 핵심 표준 디멘션 | 환자, 의사, 일자, 보험사, 진료/진단/처방 |
| 팩트 테이블 유형 | 트랜잭션, 점진적/주기적 스냅샷 |
| 고급 모델링 | 롤플레잉, 다중값, 슈퍼-서브타입, 코멘트, 이미지 처리 |
| 통합 목적 | 환자 치료 질 향상 + 비용 절감 |
| 법적 고려 | HIPAA, 개인정보보호, 마스터 데이터 정확성 |
| 코드 표준 | ICD (진단), CPT/HCPCS (진료 및 장비) |

---

# 📚 의료산업의 청구 및 지불 요청 - 점진적 스냅샷 팩트 테이블

## 1. 💼 비즈니스 컨텍스트

- **청구 부서 역할**
    - 진료 및 시설에서 발생한 비용을 집계
    - 보험사에 청구서 발송
    - 지불 상태 추적
- **분석 목적**
    - 환자, 의사, 시설, 진단, 진료, 청구 일자별 총 청구 금액 분석
    - 지불 완료 여부 및 회수율
    - 회수까지 소요된 기간
    - 미회수 청구 건의 상태

---

## 2. 🏗️ 팩트 테이블의 그레인 선택

| 구분 | 설명 |
| --- | --- |
| 트랜잭션 그레인 | 청구 및 지불 각각의 행위가 팩트 테이블의 한 행으로 표현됨 |
| 주기적 스냅샷 | 장기간 상태 변화 추적 (예: 보험 정책) – 의료 청구에는 적합하지 않음 |
| 점진적 스냅샷 | 상태가 누적되며 갱신되는 방식, 의료 청구에 적합 |

---

## 3. 🧾 점진적 스냅샷 예시 - 주요 일자들

| 일자 유형 | 설명 |
| --- | --- |
| 진료 일자 | 최초 진료가 있었던 날짜 |
| 주/부 보험 청구 일자 | 각 보험사에 청구된 날짜 |
| 책임 당사자 청구 일자 | 본인 부담 청구 일자 |
| 최근 주/부 보험 지불 일자 | 실제 지급된 날짜 |
| 정산 완료 일자 | 최종적으로 모든 지불이 완료된 시점 |

💡 이 모든 일자는 **일자 디멘션**과 연결되며, 널(null)을 허용하지 않기 때문에 초기에는 '추후 확정'이라는 특수 값으로 연결됨.

---

## 4. 🔄 점진적 스냅샷 팩트 행의 생애

1. 최초 진료 발생 → 팩트 행 생성
2. 이후 시점에 순차적으로:
    - 주 보험 지불
    - 부 보험 청구 및 지불
    - 책임 당사자 청구 및 지불
    - 정산 완료
3. 해당 시점마다 **동일한 행이 갱신**됨

🧠 **중요 개념**: 행은 누적된 히스토리를 담고 있고, 변경이 발생할 때마다 기존 행을 찾아 갱신함

---

## 5. 📐 팩트 테이블 구성 요소

### 💡 주요 디멘션

- 환자
- 책임 당사자
- 의사 및 소속 조직
- 진료 및 진단
- 주/부 보험자
- 시설
- 마스터 청구 ID
- 여러 개의 **일자 디멘션** (롤플레잉 방식 사용)

### 💰 주요 측정값 (Facts)

- 청구 금액
- 주/부 보험 지불 금액
- 책임 당사자 지불 금액
- 총 지불 금액 (= 계산)
- 추심 대상 금액
- 대손 상각 금액
- 지불 잔여 금액 (= 계산)
- 입원 기간
- 각 지불까지 걸린 일수

---

## 6. 📆 일자 디멘션 - 롤플레잉 방식

- 팩트 테이블에는 8개의 일자 외래 키가 존재
- 하나의 `일자 디멘션 뷰`를 역할에 따라 8개로 분리해서 사용
    - 예: `claim_date_view`, `primary_payment_date_view` 등
- **BI 도구 사용자 편의**를 위해 각 뷰에 별도의 컬럼명 부여

---

## 7. 🧬 보험사 디멘션, 의사 디멘션의 롤플레잉 예시

| 디멘션 | 역할 예시 |
| --- | --- |
| 보험사 | 주 보험사, 부 보험사 |
| 의사 | 주치의, 추천 의사, 컨설팅 의사 |

이런 구조를 통해 다양한 역할(슈퍼타입/서브타입)을 유연하게 분석 가능

---

## 8. ⚕️ 진단 디멘션 - 다중 값 처리

- 환자는 진료 시 여러 진단을 동시에 받을 수 있음
- 다중 진단 처리를 위해:
    - 최대 진단 수 기준으로 진단 디멘션을 **롤플레잉 디멘션**으로 분리
    - 예: `diagnosis_1`, `diagnosis_2`, `diagnosis_3` 등의 외래 키 사용

📌 이로써 분석 시 각 진단명을 독립적으로 활용 가능

---

## 9. ⚙️ 성능 최적화 전략

- 점진적 스냅샷은 **갱신이 잦음** → 디스크 성능에 영향
- 대부분의 행이 일정 시점 이후 **안정화**되므로:
    - 물리적 재배치 (클러스터링)
    - 진료 일자 기준 **파티셔닝** 수행
    - 변경 없는 파티션은 고정화하여 성능 향상

---

## ✅ 핵심 요약

| 항목 | 설명 |
| --- | --- |
| 점진적 스냅샷의 핵심 | 누적된 상태를 하나의 행으로 표현하고 지속적으로 갱신 |
| 일자 디멘션 전략 | 여러 일자 외래 키 → 각각 뷰로 분리해 롤플레잉 방식 사용 |
| 다중 진단 처리 방법 | 진단 디멘션을 최대 진단 수 만큼 롤플레잉 방식으로 분리 |
| 성능 최적화 방안 | 행의 안정화 이후 파티셔닝 및 클러스터링 고려 |