## ✈️ Chapter 12: 운송 (Transportation)

### 1. ✅ 개요: "여정(Journey)"의 데이터 모델링

- **여정**은 사람이나 물건이 한 지점에서 다른 지점으로 이동하는 과정.
- 항공사, 패키지 배송, 선박 운송, 렌터카 서비스, 통신 네트워크 라우팅 등 다양한 산업에서 유사 개념으로 활용됨.
- **핵심 분석 단위**: 항공편 활동 (비행 탑승, 좌석 등급, 마일리지 등)

---

### 2. 🧱 항공사 버스 매트릭스 구성

### 주요 포인트

- 항공권 판매 시점은 *미수수익*, 실제 탑승이 이루어진 후에 *수익 인식*
- **DW/BI 1차 프로젝트**는 “탑승 이후” 데이터에 집중
    
    (예약/발권은 제외, 마케팅 분석에 직접 영향 없음)
    

### 마케팅 분석 요구사항

- 이용 항공편, 요금제, 좌석 업그레이드, 마일리지 획득/사용 방식
- 고객 등급(골드/플래티넘 등), 프로모션 반응, 체류일수

---

### 3. 📊 팩트 테이블의 그래뉼래러티 (Granularity)

### 🚩 팩트 테이블 4단계 그레인

| 수준 | 설명 | 활용 |
| --- | --- | --- |
| **레그(Leg)** | 비행기 이륙→착륙 구간 (중간 경유 無) | 항공 일정/지연 분석, 좌석 수, 비행 거리 등 |
| **세그먼트(Segment)** | 동일 항공편 번호로 구성된 하나 이상의 레그 | 수익, 마일리지 산정 단위 |
| **트립(Trip)** | 승객의 한 번의 여정 (항공편 갈아타기 포함) | 마케팅 분석 (전체 이동경로) |
| **예약(Booking)** | 전체 예약/확인번호 | 예약 기반 분석 가능 |

> ✅ 실제 구축 시: 세그먼트 레벨부터 시작 → 추후 레그, 트립 추가
> 

---

### 4. 🧩 디멘션 설계 및 고려사항

### 📍 주요 디멘션

| 디멘션 | 설명 | 특징 |
| --- | --- | --- |
| **일자/시간 디멘션** | 출발/도착 기준 | 타임존 고려 필요 |
| **공항 디멘션** | 출발공항, 도착공항 | 각 비행에 대해 2개 사용 |
| **승객 디멘션** | 이름, 등급, 마일리지 | 매우 크고 정교함 (수천만 건 이상) |
| **승객 프로파일 미니 디멘션** | 등급, 홈 공항, 마일리지 층 등 | SCD Type 2 or Type 4, 고속 분석 목적 |
| **항공기 디멘션** | 항공기 식별, 기종 등 |  |
| **좌석 등급 디멘션** | 이코노미/비즈니스 등 |  |
| **요금 기준 디멘션** | 변경 가능 여부, 할인 여부 등 |  |
| **판매 경로 디멘션** | 구입 방식 (온라인, 대리점 등) |  |

---

### 5. 🌀 롤 플레잉 디멘션과 일시 디멘션

- **롤 플레잉 디멘션**: 동일한 디멘션(예: 일자)을 여러 역할로 사용 (출발일자, 도착일자 등)
    - 각각 다른 alias 또는 view로 정의
- **복수 일자/시간 디멘션**: 출발/도착 시각, 예약 시각, 발권 시각 등 다양
    - 타임존이 다른 경우 **지역화** 고려 필요

---

### 6. 🌍 현지화(Localization) 및 타임존 이슈

- 글로벌 항공사의 경우, **출발지와 도착지가 서로 다른 타임존**에 있음
- 일자/시간 디멘션은 **로컬 시간, UTC 시간, 시스템 시간**을 모두 고려해야 함
- 분석 목적에 따라 각기 다른 시간 기준이 필요함

---

### 7. 🧠 핵심 인사이트 요약

| 항목 | 요약 |
| --- | --- |
| 🎯 모델링 대상 | 실제 **탑승 이력** 중심의 비행 활동 데이터 |
| 📏 그레인 선택 | **세그먼트**부터 시작 → 필요 시 레그/트립 확장 |
| 🧱 디멘션 설계 | **롤 플레잉 디멘션**, **미니 디멘션**, **시간/공항/요금** 등 다양 |
| 🌐 시간 처리 | **타임존**, **출발/도착 시간**, **다중 시간 기준** 처리 |
| 📊 마케팅 분석 활용 | 단골 고객 마일리지, 등급, 업그레이드 내역 등 정교한 분석 가능 |

---

### 💡 실무 적용 팁

- *여정 기반 산업(택배, 해운, 통신 등)**에도 동일한 모델링 방식 적용 가능
- DW/BI 프로젝트 초기에는 "고객의 실제 행동 데이터" 중심으로 구성
- 팩트 테이블은 필요에 따라 점진적으로 상세한 그레인으로 확장
- 디멘션은 확장 가능성과 히스토리 관리(SCD)를 미리 고려해 설계

---

# 📘 산업 확장 및 복합 디멘션 설계

## 1. ✈️ 항공 외 산업으로의 확장

### 1.1 해운사 (Shipping)

- **유사성**: 항공사 스키마와 구조적으로 매우 유사함.
- **주요 개념**:
    - **그레인**: 선하증권번호가 부여된 컨테이너 단위의 *특정 트림 내 레그*.
    - **디멘션 구성**:
        - **선적 모드**: 선박/트럭 등 운송 수단 분류.
        - **컨테이너 디멘션**: 사이즈, 냉장 여부, 전기 필요 여부 등.
        - **상품 디멘션**: 국제 표준 상품 코드 기반.
        - **비즈니스 엔터티 디멘션 (롤플레잉)**: 위탁자, 운송자, 관리자 등 다양한 역할의 주체 포함.
        - **퇴화 디멘션**: 선하증권번호.
    - **요금과 관세**는 *레그 단위*로 적용 가능.

### 1.2 관광 서비스 (Travel Services)

- **여행사 중심의 스키마 확장**:
    - **비행 활동** 외에 호텔 숙박, 렌터카 이용 데이터를 팩트 테이블로 확장.
    - 공통 디멘션: *일자 디멘션*, *고객 디멘션* 등 공유.
- **그레인**:
    - 호텔 숙박: 전체 숙박.
    - 렌터카: 전체 렌털 기간.
- **호텔 체인 스키마의 경우**: 서비스 이용 내역, 세부 요금 등을 포함해 더 견고한 모델링 가능.

---

## 2. 🔗 상호 연관된 디멘션 결합 (Composite Dimensions)

### 2.1 비행 좌석 등급

- **문제**: 예약 좌석(구매)과 실제 좌석(탑승)이 다를 수 있음.
- **초기 설계**: 두 개의 별도 등급 디멘션 + 업그레이드 구분자 디멘션.
- **개선 설계**: **결합된 좌석 등급 디멘션** 사용.
    - 카테시안 곱 (4 구매 등급 × 4 이용 등급 = 16행) → 업그레이드 상태까지 표현 가능.
    - 이 결합 디멘션은 **정크 디멘션(Junk Dimension)**처럼 작고 관리하기 쉬움.

> ✅ 설계 팁
> 
> 
> 대부분의 롤플레잉 디멘션은 뷰로 구현하는 것이 일반적이나,
> 
> 경우에 따라 물리적 결합 디멘션이 더 나은 선택일 수 있음 (작은 행 수, 추가 속성 필요 등).
> 

### 2.2 출발지와 도착지

- **기본 설계**: 출발공항/도착공항 각각 롤플레잉 디멘션으로 사용.
- **문제**:
    - 비SQL 사용자 입장에서 **SFO-DEN**과 **DEN-SFO**의 구분이 어렵거나 비표준 표현이 발생.
    - 비일관적인 코드 사용은 BI 환경의 혼란을 유발함.
- **개선 방안**:
    - **도시 간 경로 디멘션** 추가: 방향성 경로명, 거리, 타입 등 포함.
    - 또는 **출발지/도착지를 결합한 단일 디멘션** 사용 (단, 속성 수가 많아질 수 있음).
- **설계 고려사항**:
    - 현실에서는 모든 공항 조합이 존재하지 않으므로 실제 행 수는 제한적.
    - 속성이 너무 많다면 **출발/도착 디멘션 분리 유지**가 설계상 유리.
    - **브리지 테이블**은 과도한 복잡성을 초래하므로 지양.

---

## 3. 📆 일자와 시간에 대한 추가 고려 (예고편)

- Kimball은 일관되고 상세한 **일자 디멘션**의 중요성을 계속 강조함.
- 월/분기/회계기간/공휴일 등 다양한 계층과 표시 포함.
- 이어지는 내용에서 **시간 디멘션** 및 **시간대(time zone)**의 처리 등도 다룰 예정.

---

### ✨ 요약 정리

| 항목 | 핵심 요점 |
| --- | --- |
| 산업 확장 | 항공 외에도 해운, 관광 등 다양한 산업에 유사 적용 가능 |
| 결합 디멘션 사용 시점 | 데이터 볼륨이 작고, 속성 간 관계가 밀접할 때 |
| 출발/도착 공항 결합 고려 | 리포팅의 표준화 및 사용 편의성을 위해 필요할 수 있음 |
| 브리지 테이블 사용 권장 여부 | 이중 디멘션 관리나 경로 디멘션으로 대체하는 것이 보통 더 효율적 |