# 📘 금융 서비스 산업의 다차원 모델링 학습 노트

## 1. 산업 개요

- 금융 서비스 산업: 신용카드사, 증권사, 모기지 업체, 소매은행 등 다양한 조직 포함
- 이 장에서는 **소매은행(retail bank)**의 데이터 웨어하우스 설계를 중점적으로 다룸
- 계좌, 대출, 신용카드 등 서로 다른 성격의 금융 상품을 하나의 모델로 통합하는 것이 핵심 과제

---

## 2. 학습 목표

### 본 장에서는 다음 내용을 다룸:

- 은행 데이터 웨어하우스의 **버스 매트릭스** 설계
- 분석 단위 다양화를 위한 **디멘션 세분화**
- 고객을 묶어 분석하기 위한 **세대 디멘션**
- 계좌와 고객을 연결하는 **브리지 테이블** 및 **가중치(weight)**
- *미니 디멘션(mini-dimension)**을 활용한 동적 속성 관리
- 다양한 금융 상품을 위한 **슈퍼타입/서브타입** 모델
- 시점에 따라 바뀌는 디멘션(예: 담당자 변경)을 위한 **핫 스와퍼블 디멘션**
- 시간에 따른 변화에 유연한 **동적 구간(fact bucketing)** 모델링

---

## 3. 은행 사례와 버스 매트릭스

### ✅ 분석 목표

은행은 계좌를 단순 집계하는 것이 아니라, **세대(가족 단위)**, **지역**, **행동 점수** 등 다양한 관점에서 분석하고자 함.

> 🎯 마케팅 타겟팅 목표:
> 
> 
> "이미 계좌를 가진 세대에 추가 금융 상품을 추천"
> 

### 📊 버스 매트릭스 요약

| 팩트 테이블 | 디멘션 예시 |
| --- | --- |
| 계좌 스냅샷 팩트 | 고객, 계좌, 상품, 지역, 세대, 날짜, 행동 점수 등 |

---

## 4. 주요 설계 개념

### 4.1 디멘션 세분화의 중요성

- "너무 적은 디멘션" → 분석 유연성이 떨어짐
- 계좌 종류, 상품 유형, 고객 특성 등은 별도의 디멘션으로 세분화 필요

---

### 4.2 세대 디멘션 (Household Dimension)

- 가족 단위로 계좌를 분석하고 마케팅할 수 있도록 지원
- 고객 ↔ 세대 간 관계는 동적 (결혼, 이혼, 이사 등)
- 고객 디멘션과 별도로 세대 ID를 가지고, **계좌와 세대의 관계 테이블** 필요

---

### 4.3 계좌와 고객 간 다대다 관계 처리

### 🔁 브리지 테이블 + 가중치

- 하나의 계좌에 여러 명의 소유자 (공동 명의)
- 하나의 고객이 여러 계좌 소유 가능
- **브리지 테이블 (Account-Customer Bridge)** 필요
- 각 고객의 기여도를 반영한 **가중치(weight)** 포함 (예: A 60%, B 40%)

---

### 4.4 미니 디멘션 (Mini-Dimension)

- 고객의 행동 점수, 위험 등급, 소득 수준 등은 자주 변하고 고카디널리티
- 이들을 별도 테이블로 분리하여 **미니 디멘션**으로 관리
- 매일의 상태에 따라 조인 가능 (예: 오늘의 신용 등급)

---

### 4.5 슈퍼타입/서브타입 모델

- 모든 금융 상품을 "계좌"라는 슈퍼타입으로 보고
    
    예금, 대출, 신용카드는 서브타입으로 구분
    

### 예시:

- 공통 속성 → 슈퍼타입 테이블 (Account Supertype)
- 고유 속성 → 서브타입 테이블 (Loan Account, Credit Card Account 등)

→ 동일한 팩트 테이블에서 다루되, 관련 디멘션은 서브타입별로 분기

---

### 4.6 동적 구간화 (Fact Bucketing)

- 잔고, 대출금, 결제금 등 연속적인 수치 → **구간화(Bucketing)** 필요
- 리포팅 시점에서 동적으로 구간 나누는 것이 아니라
    
    **구간 값을 별도 디멘션으로 설계**하면 성능/유지보수에 도움
    

---

### 4.7 핫 스와퍼블 디멘션 (Hot Swappable Dimensions)

- 예: 계좌 담당자, 고객 등 시간이 지남에 따라 바뀌는 디멘션
- 팩트 테이블이 변경되지 않고도 다른 디멘션 인스턴스로 **교체(swap)** 가능해야 함
- 이중 디멘션 키와 날짜 기준의 유효성 관리 필요

---

## 5. 요약

| 주제 | 요점 정리 |
| --- | --- |
| 산업 포커스 | 소매은행 중심 금융 서비스 |
| 핵심 목표 | 다양한 금융 상품 통합 분석, 고객 중심 마케팅 강화 |
| 디멘션 설계 | 세대, 지역, 행동 점수 등으로 세분화 |
| 관계 처리 | 고객-계좌 관계는 브리지 테이블과 가중치로 처리 |
| 변동 속성 관리 | 미니 디멘션 활용 |
| 제품 다양성 대응 | 슈퍼타입/서브타입 구조 |
| 시간 민감 분석 | 핫 스와퍼블 디멘션, 동적 구간화 |

---

# 📘 학습 노트: 너무 적은 디멘션을 피하지 위한 디멘션 세분화

## ✅ 1. 문제 인식: 디멘션 수가 너무 적은 초기 모델

- **예시**: 매월 말, 각 계좌별 기초 잔고를 기록하는 스냅샷 팩트 테이블
- **그레인 선언**: "매월 × 계좌" → `월 디멘션`, `계좌 디멘션`만 존재
- **문제점**: 디멘션 수가 2개뿐이며, 설명정보(상품, 지점, 세대 등)는 계좌 디멘션에 몰빵되어 있음

## ✅ 2. 디멘션 세분화가 필요한 이유

| 이유 | 설명 |
| --- | --- |
| 🎯 **분석의 직관성 향상** | 사용자들이 상품과 지점을 독립 디멘션으로 인식함 |
| 🧠 **유지보수의 복잡도 감소** | 계좌 디멘션이 너무 커지면 관리 어려움 (특히 SCD Type 2 적용 시) |
| ⚡ **쿼리 성능 향상** | 검색 범위를 줄이고 인덱싱 최적화 유도 |

> 📌 핵심 원칙: 설명 속성은 계좌 디멘션 하나에 몰지 말고, 의미 있는 디멘션으로 분리
> 

---

## ✅ 3. 실무에서 자주 빠뜨리는 디멘션 체크리스트

> 💡 팩트 그레인을 변경하지 않으면서도 설계에 쉽게 반영 가능함
> 

| 디멘션 유형 | 설명 |
| --- | --- |
| 📈 인과 디멘션 | 프로모션, 계약, 날씨 등 "원인" 제공 |
| 🗓 다수 일자 디멘션 | 팩트가 여러 날짜에 걸친 경우 (예: 주문일, 배송일 등) |
| 🔢 퇴화 디멘션 | 송장번호, 주문번호 등 제어용 ID |
| 👥 롤플레잉 디멘션 | 동일 디멘션을 여러 역할로 사용 (ex: 주문일 vs 배송일) |
| 🔄 상태 디멘션 | 계좌 상태 (활성/비활성 등) 추적 |
| 🔍 감사 디멘션 | 데이터 수집 시간, 소스, 오류 여부 등 메타 정보 |
| 🧩 정크 디멘션 | 분류코드, 플래그, 불연속 변수 묶음 |

---

## ✅ 4. 계좌잔고 팩트 테이블에 적절한 디멘션 목록

| 디멘션 이름 | 역할 및 설명 |
| --- | --- |
| 월말 일자 | 스냅샷 기준일 |
| 지점 | 은행 지점 정보 |
| 계좌 | 계좌 식별 |
| 일차 고객 | 계좌 소유자 |
| 상품 | 예금, 대출 등 금융상품 유형 |
| 계좌 상태 | 활성, 휴면, 해지 여부 등 |
| 세대 | 계좌 보유 가구의 인구통계 정보 |

> 💡 총 7개 디멘션으로 구성된 모델은 분석 유연성과 성능을 확보함
> 

---

## ✅ 5. 특별히 주목할 디멘션 세부 설명

### 📌 상품 디멘션

- **속성**: 상품명, 상품 유형, 상품 분류
- **서브타입 필요성**: 상품 유형별 속성이 다르기 때문에 별도 관리 필요
- **예시**: 대출 상품에는 이율, 상환기간 속성이 포함됨

### 📌 지점 디멘션

- **유사 모델**: 소매점, 물류센터 디멘션
- **속성 예시**: 지점명, 지역, 개설일자 등

### 📌 계좌 상태 디멘션

- **속성 예시**: 상태 코드, 상태 설명, 변경 사유 등
- **주의사항**: 팩트에 직접 넣기보다 별도 디멘션으로 분리 (→ 미니 디멘션 사례)

### 📌 세대 디멘션

- **역할**: 은행과 고객의 관계 분석 단위
- **구성**: 수입, 주거형태, 자녀 여부, 은퇴 여부 등
- **특징**:
    - 인구통계 속성은 시간이 지남에 따라 변함 (→ Type 2 적용 필요)
    - 여러 계좌 및 소유자(존, 메리 등)가 한 세대를 구성 가능
    - 데이터 정합성 이슈 발생 가능 (주소 불일치 등)

---

## ✅ 6. 설계 팁 요약

- 5개 미만 디멘션이면 반드시 누락 여부 점검!
- 설명 속성은 의미 있는 디멘션으로 분리 (단일 디멘션에 몰지 않기)
- 팩트 테이블의 **그레인 변화 없이** 새로운 디멘션 추가 가능
- 롤플레잉/정크/감사/퇴화/상태 디멘션 등 실무에서 자주 빠뜨림

---

## 🧠 한줄 정리

> 의미 있고 독립적인 설명 속성은 반드시 디멘션으로 분리하라. 너무 적은 디멘션은 분석의 유연성과 성능을 해친다.
> 

---

# 🧠 학습 노트: 슈퍼타입과 서브타입 스키마 & 핫 스와퍼블 디멘션

---

## 1️⃣ 슈퍼타입과 서브타입 스키마란?

### 🔍 배경

- **금융 산업**에서 하나의 기관은 예금, 당좌계좌, 신용카드 등 **서로 다른 상품 특성을 가진 여러 계좌 유형**을 제공함.
- 상품마다 서로 **공통 속성과 고유 속성**이 혼재함 → 하나의 통합된 팩트 테이블로 모두 표현하기 어려움.

---

### 💡 주요 개념

| 개념 | 설명 |
| --- | --- |
| **슈퍼타입** | 여러 비즈니스 라인에서 공통적으로 사용하는 속성, 팩트만 포함하는 **통합 테이블** |
| **서브타입** | 특정 비즈니스 라인(LOB)의 상세 분석을 위한 **전용 테이블** |
| **LOB (Line of Business)** | 특정 상품 유형에 대한 독립적 사업 단위 (예: 당좌 계좌, 신용카드 등) |

---

### 🧩 설계 원칙

1. **슈퍼타입 팩트/디멘션**
    - 전체 고객 포트폴리오를 아우르는 **CRM 전략/제품간 비교 분석에 적합**.
    - 공통 속성만 포함. 각 상품 고유의 메저는 **배제**.
    - 슈퍼타입 팩트는 얕지만 넓은 시야 제공.
2. **서브타입 팩트/디멘션**
    - 특정 계좌 유형만을 위한 **깊은 분석용**.
    - 고유한 속성과 팩트를 충분히 포함 가능.
    - 슈퍼타입의 속성도 **중복 포함**하여 조인 생략.
3. **디멘션 키 공유**
    - 슈퍼타입과 서브타입 디멘션은 **동일한 대체키 사용**.
    - 특정 계좌가 여러 테이블에 존재하지만, **공통된 참조**가 가능해야 함.

---

### 📌 예시 구조

- 슈퍼타입 계좌 디멘션: `dim_account`
    - 공통 속성: 계좌번호, 개설일, 고객ID 등
- 서브타입 (예: 당좌 계좌): `dim_account_checking`, `fact_checking_account`
    - 속성 예: 수표 발행 한도, 최소 잔고, 이체 수수료
- 슈퍼타입 팩트 테이블: `fact_account_overview`
    - 공통 메저: 총 잔고, 이자율 등

---

### ⚠️ 주의사항

- 서브타입 팩트/디멘션은 **중복이 아님**, 오히려 **비즈니스 요구에 최적화된 설계**.
- 모든 팩트를 슈퍼타입에 넣으면 **NULL이 많은 비효율적인 테이블(스위스 치즈)**이 됨.
- 계좌/제품별 서브타입 스키마는 전체 분석과 개별 분석을 **균형 있게 지원**함.

---

## 2️⃣ 핫 스와퍼블 디멘션 (Hot Swappable Dimensions)

### 🧭 정의

- 동일한 팩트 테이블에 대해 **다양한 디멘션 버전**을 쿼리 시점에 유연하게 연결할 수 있는 방식.

---

### 🧪 사용 예시

- **증권사 고객별 맞춤 주식 정보** 제공:
    - 팩트: `fact_stock_prices` (고가, 저가, 종가 등)
    - 고객A: `dim_stock_for_customer_A`
    - 고객B: `dim_stock_for_customer_B`
    - 쿼리 시점에 **특정 고객의 디멘션으로 교체(스왑)**

---

### ⚙️ 구현 요령

- 참조 무결성 제약조건 (FK 제약) 해제
- 쿼리 시 동적으로 원하는 디멘션 테이블로 조인
- BI/쿼리 툴에서 **파라미터나 사용자 설정 기반 스왑** 구성

---

### ✅ 장점

- 사용자 맞춤 데이터 제공 가능
- **하나의 팩트**로 다양한 디멘션 요구 충족

### ⚠️ 단점

- 데이터 모델이 **복잡**해질 수 있음
- 무결성 관리가 어려워질 수 있음 → 설계 및 관리 전략 필요

---

## 📝 정리 요약

| 구분 | 슈퍼타입/서브타입 | 핫 스와퍼블 디멘션 |
| --- | --- | --- |
| 목적 | 제품별 공통 vs 개별 분석 | 사용자별 디멘션 교체 |
| 구성 | 슈퍼타입 + 서브타입 디멘션 및 팩트 | 하나의 팩트 + 복수 디멘션 테이블 |
| 장점 | 통합성과 전문성 동시 확보 | 개인화된 분석 제공 |
| 주의사항 | NULL 과다 방지, 디멘션 키 일관성 유지 | 참조 무결성 제약 해제 필요 |