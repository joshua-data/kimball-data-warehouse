# 🧠 이커머스

## ✅ 학습 목표

- 클릭스트림(clickstream)의 정의와 특성 이해
- 클릭스트림 데이터의 다차원 모델링 접근
- 구글 애널리틱스와 외부 서비스의 역할
- 클릭스트림과 전통적 DW/BI 데이터 통합 방법
- 웹 채널 수익성 분석 기법

---

## 1. 📌 클릭스트림이란?

- **정의**: 웹사이트 방문자가 남긴 모든 활동 로그 (페이지 조회, 클릭 등)
- **구성 요소**: 페이지, 세션, 경로 등의 특화된 디멘션 포함
- **특징**
    - 전통적 원천 데이터와 다른 데이터 형태
    - 대량, 고빈도, 비정형적인 데이터 흐름 (데이터 급류)
    - 분산 서버 환경 → 로그 수집·동기화 어려움

---

## 2. 🔄 클릭스트림 원천 데이터의 복잡성

- **데이터 형식 다양성**: 각기 다른 웹 서버 로그 포맷 사용
- **동기화 문제**: 시간 동기화가 어려움 (서버마다 시스템 시간 다름)
- **데이터 수집 범위**
    - 자사 로그뿐 아니라, 외부 파트너사, ISP 데이터, 검색 엔진 키워드까지 포함 가능
- **무상태성(Stateless)**
    - HTTP는 상태를 유지하지 않음 → 세션 추적 어려움
- **익명성 문제**
    - 방문자 신원 식별 어려움 → 세션 구분도 모호

---

## 3. ⚠️ 클릭스트림의 문제점 요약

| 구분 | 설명 |
| --- | --- |
| 방문 경로 식별 | 기본 페이지, 검색엔진, 즐겨찾기, 외부링크 등 다양. 추천 로그를 통해 분석 |
| 세션 식별 | 세션 ID 필요. HTTP는 상태 유지하지 않음 → 별도 기술 필요 |
| 신원 식별 | 쿠키 사용, IP 추적 등으로 해결 시도하지만 완전하지 않음 |

---

## 4. 🧪 세션 식별 방법

| 방법 | 설명 | 장단점 |
| --- | --- | --- |
| ① IP 주소 기반 | 동일 IP 내 짧은 시간 간격 로그를 하나의 세션으로 간주 | 쿠키 불필요, 단 사용자 간 중복 가능 |
| ② 세션 쿠키 | 브라우저가 열려있는 동안 유지되는 쿠키 사용 | 명확한 구분 가능, 단 세션 종료 후 불분명 |
| ③ SSL 추적 | 로그인 기반 식별. SSL 기반 세션 추적 | 보안성 높음, 단 성능 오버헤드 큼 |

---

## 5. 📊 다차원 모델링에의 통합

- **모델링 대상 디멘션**
    - 방문자 (Visitor)
    - 세션 (Session)
    - 페이지 (Page)
    - 경로/캠페인 (Path/Campaign)
- **팩트 테이블**
    - 페이지 조회 수, 체류 시간, 클릭 이벤트 등
    - 디지털 전환(Conversion) 트래킹 가능

---

## 6. 🌍 외부 서비스: Google Analytics

- **역할**: 외부에서 수집한 웹 로그 분석 (방문수, 이탈률 등)
- **특징**
    - 내부 DW와 별도 존재
    - 기본적으로는 샘플링된 데이터 제공
    - 사용자 단위 분석이 어려운 점 있음
- **활용법**
    - DW와의 데이터 병합
    - 마케팅 캠페인 효과 측정

---

## 7. 🔗 전사 버스 아키텍처 통합

- **클릭스트림 데이터는 DW의 또 다른 업무 프로세스로 간주 가능**
- **웹 트랜잭션 → 전통적 소매 트랜잭션과 연결**
    - 예: 웹에서의 주문 → 배송 → 반품 → 고객 서비스 연결
- **버스 매트릭스(Bus Matrix)에 통합**하여 전체적인 고객 행동 흐름 파악 가능

---

## 8. 💰 웹 수익성 측정

- **문제점**: 페이지 조회는 수익과 직접 연계되지 않음
- **해결 전략**
    - 전환율 추적 (Conversion)
    - 고객 세그먼트별 비용-수익 배분
    - 캠페인별 ROI 분석

---

# 📚 클릭스트림

## 1. 클릭스트림 모델 설계 전 포트폴리오 구성

- 웹 기반 소매 환경의 다양한 **디멘션**들을 사전에 포트폴리오로 정리해두는 것이 중요하다.
- 모든 모델이 이 디멘션들을 사용하지는 않지만, **향후 확장성**을 위해 준비되어 있어야 한다.

### 📦 일반 디멘션 목록

```
일자, 시간, 부품, 공급자, 상태, 운송사, 창고 위치, 상품, 고객, 채널, 프로모션, 내부 조직, 직원

```

### 🌐 클릭스트림 특화 디멘션

```
페이지 (Page)
이벤트 (Event)
세션 (Session)
방문 경로 (Referrer Path)

```

---

## 2. 각 디멘션 설명 및 설계 고려사항

### 2.1. 📄 페이지 디멘션

- **정적/동적 페이지 모두 포괄**해야 함
- 페이지를 **기능/유형 기준으로 그룹화**하여 관리
- **이력관리 방식 선택**
    - **Type 1 (덮어쓰기)**: 정의가 변경되면 새 값으로 덮어씀
    - **Type 2 (이력 관리)**: 이전 정의 보존 가능
- **협업 필요**: 웹 마스터, DW/BI 아키텍트, 웹 개발자 간 협력 필수
- **중요 필드**: 페이지 ID, 페이지 유형, 설명, 페이지 URL 등

🔎 **주의**: 페이지 내의 링크/이미지 등까지 추적할 경우 **초고해상도 데이터(10TB/day 이상)** 발생 가능

---

### 2.2. ⚡ 이벤트 디멘션

- 이벤트는 사용자의 **행동 단위**를 의미
- 주요 이벤트:
    - 페이지 열기
    - 새로 고침
    - 링크 클릭
    - 데이터 입력
- **간결한 이벤트 사전**을 사용하여 팩트 테이블과 연결

---

### 2.3. 🧭 세션 디멘션

- 세션 = **사용자 단위 방문 활동 묶음**
- 전반적인 **문맥 정보**와 **성과 상태**를 포함
    - 국지적 문맥 (현재 페이지의 의미)
    - 전반적 문맥 (전체 세션의 목적)
- **고객 상태 속성**은 빠르게 변하므로 고객 디멘션에 포함하지 않고 별도 관리
- **미니 디멘션** 사용 고려:
    - 다양한 상태 유형(예: 장바구니 있음/없음, 로그인 상태 등)을 캡처

📊 **분석 질문 예시**:

- 상품 정보만 본 고객 수?
- 장바구니 추가 후 이탈한 고객 수?

---

### 2.4. 🚪 방문 경로 디멘션

- 고객이 **해당 페이지에 도달한 경로**를 추적
- 주요 속성:
    - 이전 페이지 URL
    - 리퍼러 도메인
    - 검색 엔진/키워드
- **검색 조건**은 간소화된 상태로 저장
    - 원시 검색어는 분석에 부적합할 수 있음

---

## 3. 클릭스트림 팩트 테이블 설계

### 🧱 팩트 테이블 기본 원칙

- **그레인(grain)**: “고객의 **완결된 세션**당 1개 Row”
    - 페이지뷰 단위 아님!
    - 이유: 데이터 폭발 방지 (예: 하루 10억건 이벤트 → 2천만 세션)

### 포함할 디멘션

```
일자, 시간, 고객, 페이지, 세션, 방문 경로

```

### 지표 (Measures)

- 세션 시간 (총 체류 시간)
- 방문 페이지 수
- 주문 수
- 주문 수량
- 총 주문 금액

---

### ⏱ 일자 디멘션이 2개 필요한 이유

- **세션 시작 일자/시간**
- **세션 종료 일자/시간**
- **다른 시간대 서버 간 동기화 필요**
    - UTC 또는 GMT 기준으로 통합 저장
    - DW/BI 환경 전체에서 **일관된 시간 기준 확보**

---

## 4. 설계 시 유의사항

| 항목 | 설명 |
| --- | --- |
| ✅ 그레인 설정 | 너무 상세하면 유지 불가, 의미 있는 요약 수준에서 모델링 |
| ✅ 디멘션 포트폴리오 | 전체 환경을 고려하여 잠재 디멘션 포함 |
| ✅ 이력 관리 | 디멘션에 따라 Type 1, 2 구분 적용 |
| ✅ 협업 | 웹 마스터, 데이터 거버넌스 담당자, 개발자 협력 필요 |
| ✅ 시간 동기화 | 시스템 간 시간 차이를 UTC로 맞춤 |

---

## ✨ 학습 요약

- 클릭스트림 모델은 **트래픽이 많은 웹 환경에서 필수적인 요약 구조**이다.
- 세션을 기반으로 한 설계는 **데이터 양을 줄이면서도 분석에 충분한 정보**를 담는다.
- 동적 페이지나 게임처럼 초미세 단위 데이터를 추적하는 경우, **디멘션과 팩트 구조의 조합을 신중히 설계**해야 한다.

---

# 📘 웹 기반 소매점의 클릭스트림 통합과 수익성 분석

---

## 1. 클릭스트림을 웹 기반 소매점의 **버스 매트릭스**에 통합하기

### 📌 개요

- **버스 매트릭스**는 전사 데이터웨어하우스의 전반적인 주제 영역과 공통 디멘션을 보여줌
- 각 행은 하나의 업무 프로세스 (ex. 주문, 반품, 클릭스트림 등) 를 나타냄
- 각 열은 디멘션 (ex. 고객, 날짜, 상품 등)

### 📌 특징 요약

- `일자/시간`, `조직`, `직원`, `상품`, `고객` 등의 **공통 디멘션**이 여러 업무 프로세스에서 재사용됨
- 클릭스트림은 **고객 중심 프로세스**에 속하며, 다른 업무와 디멘션 공유 가능
    - 공유 디멘션: 일자/시간, 상품, 고객, 미디어, 원인, 서비스 정책
- 클릭스트림은 별도 특화된 디멘션 4개 포함 (예: 세션 정보 등)

### ✅ 통합의 장점

- 표준 디멘션을 공유하여 클릭스트림 데이터를 기존 DW에 자연스럽게 통합 가능
- 다양한 업무 프로세스를 하나의 리포트 행으로 연결 가능
- 특화 디멘션으로 **웹 행동이 실제 구매나 정책 선택에 어떤 영향을 주었는지 분석 가능**

### 🧠 인사이트

- **표준화된 디멘션**이 많다는 것은 DW/BI 팀이 디멘션 관리 전략을 수립할 필요가 있음을 뜻함
- **버스 매트릭스는 커뮤니케이션 도구로도 강력함** → 표준 디멘션 필요성 강조 가능

---

## 2. 웹을 포함한 채널 간 **수익성 분석**

### 📌 수익성 분석의 도전

- 단일 채널이 아닌 **모든 판매 채널(웹, 매장, 콜센터 등)**에서 수익성을 종합적으로 평가
- 웹 수익성 측정이 까다로운 이유:
    - 클릭스트림은 수익을 직접 유도하지 않는 세션도 포함
    - 세션 단위로 비용을 배분하기 어려움

### 📌 접근 전략

- **매출 트랜잭션 팩트 테이블** 확장 → 손익 분석 가능
    - 팩트의 grain은 고객에게 발행된 개별 **매출 전표의 품목 수준**
    - 동일한 팩트 구조로 웹/매장/전화 판매 등 통합 분석

### ✅ 주요 디멘션

- 일자, 시간, 고객, 채널, 상품, 프로모션, 전표번호 (→ 디젠너레이트 디멘션)

### 📌 손익 팩트 테이블 구조

- **기초 측정값**: 판매 수량, 총 수입, 순 수입
- **순 수입 계산**: 총 수입 - 할인/원가 등
- **총 수익(Gross Margin)**: 순 수입 - 제조 원가/매입 원가 - 보관비 등
- 이외 추가 비용을 빼며 세부 손익 계산

### 🧮 계산 칼럼 저장 여부

| 방식 | 장점 | 단점 |
| --- | --- | --- |
| **물리적으로 저장** | 사용자 직접 접근 시 오류 방지 | 저장 공간 차지 |
| **뷰(View)로 계산** | 공간 절약, 유지 관리 쉬움 | 성능 이슈 가능 |

→ 사용자가 물리 테이블을 직접 접근한다면 **명시적 칼럼 생성**이 안전

---

## 3. 비용 배분의 현실과 제약

### 📌 비용 배분 이슈

- 손익 분석의 가장 큰 어려움은 **비용 데이터의 추출 및 분배**
- 비용은 다양한 정밀도로 존재
    - 일부는 **국가 단위 평균값**만 존재
    - 일부는 **지역/분기별 수준**으로 추정 가능
    - 일부는 **정확한 활동 기반 비용** 존재

### 📌 웹 관련 비용 배분 예시

- 웹사이트 운영 비용은 인프라 비용이지만 제품 라인에 간접적으로 연결 가능
- 배분 기준 예시:
    - 각 상품별 웹 페이지 수
    - 상품 페이지 조회 수
    - 웹 기반의 매출 비율

---

## 4. DW/BI팀의 역할과 현실적인 태도

- DW/BI팀이 전사 비용 배분을 **책임질 필요는 없음**
- 다만, **가장 현실적이고 신뢰할 수 있는 비용 데이터를 기반으로 손익 모델 설계**
- 비용 일부는 단순 비율, 일부는 활동 기반의 정확한 계산이 혼합될 수 있음
- **수익성과 관련된 데이터 품질과 정밀도는 시간이 지나면서 개선 가능**

---

## 🧩 정리 요약

| 항목 | 핵심 내용 |
| --- | --- |
| **버스 매트릭스** | 주제 영역 간 디멘션 공유 여부를 시각화한 도구 |
| **클릭스트림 통합** | 표준 디멘션을 공유해 다른 프로세스와 통합 가능 |
| **웹 수익성 분석** | 전체 채널 수익성을 매출 팩트 확장을 통해 분석 |
| **손익 팩트 구조** | 총 수입, 순 수입, 총 수익 등 단계적 금액 분석 |
| **비용 배분 과제** | 비용은 다양한 수준의 정확도와 granularity 가짐 |
| **DW/BI팀의 방향** | 현실 가능한 비용 데이터를 기반으로 손익 모델 구현 |